<h1>Character Sorter</h1>

<!-- Setup Phase -->
<div *ngIf="!isSorting && sortedCharacters.length === 0 && !kingOfTheHillWinner" class="setup">
  <div class="filters">

    <div class="filter-group">
      <h3>Sort Mode</h3>
      <div class="filter-section">
        <label>
          <input type="radio" name="sortMode" [(ngModel)]="sortMode" value="ranking">
          Complete Ranking
        </label>
        <label>
          <input type="radio" name="sortMode" [(ngModel)]="sortMode" value="kingOfTheHill">
          King of the Hill
        </label>
      </div>
      <div class="filter-description">
        <p *ngIf="sortMode === 'ranking'">
          Battle it outâ€”rank everyone from best to worst!
        </p>
        <p *ngIf="sortMode === 'kingOfTheHill'">
          Battle for the topâ€”last one standing wins!
        </p>
      </div>
    </div>

    <div class="filter-group">
      <h3>Gender</h3>
      <div class="filter-section">
        <label>
          <input type="radio" name="filter" [(ngModel)]="genderFilter" value="all">
          {{genderAllLabel}}
        </label>
        <label>
          <input type="radio" name="filter" [(ngModel)]="genderFilter" value="boys">
          {{genderBoysLabel}}
        </label>
        <label>
          <input type="radio" name="filter" [(ngModel)]="genderFilter" value="girls">
          {{genderGirlsLabel}}
        </label>
      </div>
    </div>

    <div class="filter-group">
      <h3>Character Types</h3>
      <div class="filter-section">
        <label>
          <input type="checkbox" [(ngModel)]="includeActive">
          Active Characters
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="includeInactive">
          Inactive Characters
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="includeSide">
          Side Characters
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="includeRetired">
          Retired Characters
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="includeMe">
          Me
        </label>
      </div>
    </div>
  </div>
  <button (click)="start()" class="start-button">Start Sorting</button>
</div>

<!-- Sorting Phase -->
<div *ngIf="isSorting && currentPair" class="sorting">
  <h2>Round {{progress + 1}}</h2>

  <div class="comparison">
    <div class="character-option" (click)="choose(currentPair[0])">
      <img [src]="'assets/' + currentPair[0].img" [alt]="currentPair[0].name">
      <h3>{{currentPair[0].shortName || currentPair[0].name}}</h3>
    </div>

    <div class="tie-option">
      <button (click)="chooseTie()" class="tie-button">Tie</button>
      <button class="back-button" (click)="back()" [disabled]="!canGoBack()">Undo</button>
    </div>

    <div class="character-option" (click)="choose(currentPair[1])">
      <img [src]="'assets/' + currentPair[1].img" [alt]="currentPair[1].name">
      <h3>{{currentPair[1].shortName || currentPair[1].name}}</h3>
    </div>
  </div>
</div>

<!-- Results Phase -->
<div *ngIf="!isSorting && sortedCharacters.length > 0" class="results">
  <h2>Your Rankings</h2>  
  <ol class="ranking-list">
    <li *ngFor="let char of sortedCharacters; let i = index" class="ranking-item">
      <span class="rank">{{getDisplayRank(i, char)}}</span>
      <img *ngIf="i < 3" [src]="'assets/' + char.img" [alt]="char.name">
      <span class="name">{{char.shortName || char.name}}</span>
    </li>
  </ol>
  <button (click)="takeScreenshot()" class="screenshot-button">ðŸ“· Download Screenshot</button>
  <button (click)="sortedCharacters = []" class="restart-button">Start Over</button>
</div>

<!-- King of the Hill Winner -->
<div *ngIf="kingOfTheHillWinner" class="character-win">
  <img [src]="'assets/' + kingOfTheHillWinner.img" [alt]="kingOfTheHillWinner.name">
  <h2>Champion: {{kingOfTheHillWinner.name}}</h2>
  <button (click)="resetKingOfTheHill()" class="restart-button">Start Over</button>
</div>

<app-back-button></app-back-button>